# 产品需求文档 (PRD)

**项目名称：** DotMatrix Cam (暂定名)
**平台：** Android
**版本：** V1.3 (UI与交互优化版)
**文档状态：** 已更新

## 1. 产品概述 (Overview)

### 1.1 产品定位

一款极致简约的**复古点阵/半调网纹（Halftone）**特效相机。通过 GPU 实时渲染，将现实世界转化为由红黄蓝白黑构成的几何点阵艺术，强调“所见即所得”的创作体验。

### 1.2 核心价值

* **实时预览：** 拍摄前即可看到最终的二值化点阵效果，无需后期处理。
* **直观的曝光控制：** 默认实时自动曝光，曝光滑块始终可见，拖动即进入手动模式，并可随时一键恢复自动。
* **风格化模式：** 内置“标准”与“韵律”两种点阵风格，满足不同创作需求。
* **自由的色彩搭配：** 除了预设的黑白主题，用户可以从一个精心挑选的调色板中为点和背景分别选择颜色。

---

## 2. 用户流程 (User Flow)

1. **冷启动** -> 直接进入拍摄预览界面，竖向密度滑块、横向曝光滑块均可见，实时自动曝光已激活。
2. **曝光调节** -> 用户可随时拖动曝光滑块进行手动曝光补偿。点击滑块旁的“自动”按钮可恢复自动曝光。
3. **风格切换** -> 用户通过UI按钮在“标准”和“韵律”模式间切换。
4. **颜色选择** -> 用户可在“黑底白点”、“白底黑点”和“自定义颜色”之间切换。在自定义模式下，可为点和背景分别选择颜色。
5. **拍摄** -> 点击快门，瞬时生成带有当前所有效果的图片。
6. **反馈** -> 屏幕提示“已保存”，图片进入系统相册。

---

## 3. 功能需求详情 (Functional Requirements)

### 3.1 核心取景器与交互 (Viewfinder & Interaction)

* **实时渲染：** 画面必须保持高帧率（>24fps）显示滤镜后的点阵效果。
* **曝光控制 (更新)：**
    * **评价测光：** 自动曝光基于整个画面的平均亮度。
    * **滑块默认可见：** 曝光滑块始终显示在UI上。
    * **自动/手动切换：** 默认自动曝光。当用户**拖动滑块**时，立即切换到手动模式。提供一个“自动”按钮，供用户随时点击恢复自动曝光。
* **摄像头切换：** 提供悬浮按钮切换前置/后置摄像头。

### 3.2 效果控制参数 (Effect Control)

#### A. 渲染模式 (Render Mode)

* **交互：** 两个并排的图标按钮，点击切换。
* **选项：**
    1. **标准模式 (Standard):** 传统的半调网纹，点阵在规整的网格上，大小随亮度变化。
    2. **韵律模式 (Rhythmic):** 艺术化的点阵，排布不规则，点的大小和颜色（黑/白）根据亮度动态变化。

#### B. 画面参数滑块 (Adjustment Sliders)

* **滑块 1：像素密度 (Density)**
    * **布局 (更新)：** 竖向放置于屏幕右侧。
    * **范围：** 20 (极粗糙) ~ 150 (高清)。
* **滑块 2：曝光补偿 (Exposure)**
    * **布局 (更新)：** 横向放置于底部控制区，始终可见。
    * **范围：** 0.05 (极暗) ~ 0.95 (极亮)。

#### C. 色彩风格 (Color Theme) (更新)

* **交互：** 底部提供三个主要入口： “黑底白点”、“白底黑点”、“自定义”。
* **自定义模式：**
    * 点击“自定义”按钮后，展开颜色选择器。
    * 用户可以为“点阵”和“背景”分别从一个预设的8色调色板（金、银、红、黄、绿、蓝、黑、白）中选择颜色。

### 3.3 拍摄与输出 (Capture & Output)

* **成像方式：** 从 `GLSurfaceView` 的帧缓冲区直接抓取像素，确保“所见即所得”，照片与预览效果完全一致。
* **文件格式：** JPG。
* **存储路径：** 系统标准相册 (`Pictures/DotMatrixCam`)。

---

## 4. UI 界面布局 (UI Layout)

| 区域 | 组件 | 说明 |
| --- | --- | --- |
| **顶部功能区** | [前后摄] | 悬浮图标。 |
| **右侧功能区** | **竖向密度滑块** | 垂直于屏幕边缘。 |
| **中央预览区** | **实时画面** |  |
| **底部控制区** | **曝光滑块**与**自动按钮** | 始终可见。 |
|  | **模式切换栏** | [标准] [韵律] |
|  | **颜色切换栏** | [白底黑点] [黑底白点] [自定义] |
|  | **自定义颜色选择器** | 默认隐藏，点击“自定义”后展开。 |
| **底部操作栏** | [相册入口] **(快门键)** [设置] | 快门键设计为实心圆。 |

---

## 5. 技术实现关键点 (Technical Notes)

1. **Shader 核心算法：**
* Fragment Shader 中包含 `STANDARD` 和 `RHYTHMIC` 两种模式的独立渲染逻辑。

2. **曝光算法 (更新)：**
* **亮度计算：** 在 `ImageAnalysis.Analyzer` 中，对整个画面的亮度进行采样，实现评价测光。

3. **机型适配：**
* **CameraX API：** 继续使用 CameraX 简化相机开发。

---
